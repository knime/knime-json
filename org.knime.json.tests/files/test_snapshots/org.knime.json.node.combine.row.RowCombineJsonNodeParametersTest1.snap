{
  "data" : {
    "model" : {
      "inputColumn" : "json",
      "newColumn" : "JSON",
      "collectType" : "Array",
      "objectKeyColumn" : {
        "specialChoice" : "ROW_ID"
      },
      "jsonStructure" : "NESTED",
      "rootKey" : "root",
      "keyValuePairs" : [ ]
    }
  },
  "schema" : {
    "type" : "object",
    "properties" : {
      "model" : {
        "type" : "object",
        "properties" : {
          "collectType" : {
            "oneOf" : [ {
              "const" : "Array",
              "title" : "Array"
            }, {
              "const" : "Object",
              "title" : "Object with key"
            } ],
            "title" : "Combine rows as",
            "description" : "Configure how to collect the JSON values.\n<ul>\n<li><b>Array</b>: The rows are collected into a JSON array.</li>\n<li><b>Object with key</b>: The rows become an object within another object with the keys specified by the selected column's values (will fail if there are duplicates).</li>\n</ul>",
            "default" : "Array"
          },
          "inputColumn" : {
            "type" : "string",
            "title" : "JSON column",
            "description" : "The JSON column providing the values for the array.",
            "default" : "json"
          },
          "jsonStructure" : {
            "oneOf" : [ {
              "const" : "NESTED",
              "title" : "Under root key"
            }, {
              "const" : "TOP_LEVEL",
              "title" : "At top level"
            } ],
            "title" : "Place resulting JSON",
            "description" : "How to structure the resulting JSON output.\n<ul>\n<li><b>Under root key</b>: Place the resulting JSON under a root key alongside optional additional properties.</li>\n<li><b>At top level</b>: Generate resulting JSON as top level object.</li>\n</ul>",
            "default" : "NESTED"
          },
          "keyValuePairs" : {
            "type" : "array",
            "items" : {
              "type" : "object",
              "properties" : {
                "key" : {
                  "type" : "string",
                  "title" : "Key",
                  "description" : "Additional property key.",
                  "default" : ""
                },
                "value" : {
                  "type" : "string",
                  "title" : "Value",
                  "description" : "Additional property value.",
                  "default" : ""
                }
              }
            },
            "title" : "Additional properties",
            "description" : "Additional key/value pairs to add to the root object.",
            "default" : [ ]
          },
          "newColumn" : {
            "type" : "string",
            "title" : "New column name",
            "description" : "Name of the new (single, JSON) column in the output table.",
            "default" : "JSON"
          },
          "objectKeyColumn" : {
            "type" : "object",
            "properties" : {
              "regularChoice" : {
                "type" : "string"
              },
              "specialChoice" : {
                "oneOf" : [ {
                  "const" : "ROW_ID",
                  "title" : "RowID"
                } ]
              }
            },
            "title" : "Object key column",
            "description" : "The column providing the keys for the object when collecting into object. The rows become an object within another object with the keys specified by the selected column's values (will fail if there are duplicates). Select \"RowID\" to use the Row IDs as object keys.",
            "default" : {
              "specialChoice" : "ROW_ID"
            }
          },
          "rootKey" : {
            "type" : "string",
            "title" : "Root object key",
            "description" : "Key under which to place the resulting JSON.",
            "default" : "root"
          }
        }
      }
    }
  },
  "ui_schema" : {
    "elements" : [ {
      "type" : "Control",
      "scope" : "#/properties/model/properties/inputColumn",
      "options" : {
        "format" : "dropDown"
      },
      "providedOptions" : [ "possibleValues" ]
    }, {
      "type" : "Control",
      "scope" : "#/properties/model/properties/newColumn",
      "options" : {
        "validation" : {
          "pattern" : {
            "errorMessage" : "The field cannot be blank (it must contain at least one non-whitespace character).",
            "parameters" : {
              "pattern" : ".*\\S.*"
            }
          }
        }
      }
    }, {
      "label" : "JSON Structure",
      "type" : "Section",
      "elements" : [ {
        "type" : "Control",
        "scope" : "#/properties/model/properties/collectType",
        "options" : {
          "format" : "valueSwitch"
        }
      }, {
        "type" : "Control",
        "scope" : "#/properties/model/properties/objectKeyColumn",
        "options" : {
          "format" : "singleSelection",
          "specialChoices" : [ {
            "id" : "ROW_ID",
            "text" : "RowID"
          } ]
        },
        "providedOptions" : [ "possibleValues" ],
        "rule" : {
          "effect" : "SHOW",
          "condition" : {
            "scope" : "#/properties/model/properties/collectType",
            "schema" : {
              "oneOf" : [ {
                "const" : "Object"
              } ]
            }
          }
        }
      }, {
        "type" : "Control",
        "scope" : "#/properties/model/properties/jsonStructure",
        "options" : {
          "format" : "valueSwitch"
        }
      }, {
        "type" : "Control",
        "scope" : "#/properties/model/properties/rootKey",
        "rule" : {
          "effect" : "SHOW",
          "condition" : {
            "scope" : "#/properties/model/properties/jsonStructure",
            "schema" : {
              "oneOf" : [ {
                "const" : "NESTED"
              } ]
            }
          }
        }
      }, {
        "type" : "Control",
        "scope" : "#/properties/model/properties/keyValuePairs",
        "options" : {
          "detail" : [ {
            "type" : "HorizontalLayout",
            "elements" : [ {
              "type" : "Control",
              "scope" : "#/properties/key"
            }, {
              "type" : "Control",
              "scope" : "#/properties/value"
            } ]
          } ],
          "addButtonText" : "Add property",
          "elementLayout" : "HORIZONTAL_SINGLE_LINE"
        },
        "rule" : {
          "effect" : "SHOW",
          "condition" : {
            "scope" : "#/properties/model/properties/jsonStructure",
            "schema" : {
              "oneOf" : [ {
                "const" : "NESTED"
              } ]
            }
          }
        }
      } ]
    } ]
  },
  "persist" : {
    "type" : "object",
    "properties" : {
      "model" : {
        "type" : "object",
        "properties" : {
          "inputColumn" : {
            "configKey" : "inputColumn"
          },
          "newColumn" : {
            "configKey" : "newColumn"
          },
          "collectType" : {
            "configKey" : "objectOrArray"
          },
          "objectKeyColumn" : {
            "configPaths" : [ [ "objectKeyRowID" ], [ "objectKeyColumn" ] ]
          },
          "jsonStructure" : {
            "configPaths" : [ [ "addRootKey" ] ]
          },
          "rootKey" : {
            "configKey" : "rootKey"
          },
          "keyValuePairs" : {
            "configPaths" : [ [ "keys" ], [ "values" ] ]
          }
        }
      }
    }
  },
  "initialUpdates" : [ {
    "scope" : "#/properties/model/properties/inputColumn",
    "providedOptionName" : "possibleValues",
    "values" : [ {
      "indices" : [ ],
      "value" : [ {
        "id" : "json",
        "text" : "json",
        "type" : {
          "id" : "org.knime.core.data.json.JSONValue",
          "text" : "JSON"
        }
      }, {
        "id" : "other_column",
        "text" : "other_column",
        "type" : {
          "id" : "org.knime.core.data.json.JSONValue",
          "text" : "JSON"
        }
      } ]
    } ]
  }, {
    "scope" : "#/properties/model/properties/objectKeyColumn",
    "providedOptionName" : "possibleValues",
    "values" : [ {
      "indices" : [ ],
      "value" : [ {
        "id" : "string_column",
        "text" : "string_column",
        "type" : {
          "id" : "org.knime.core.data.StringValue",
          "text" : "String"
        }
      } ]
    } ]
  } ]
}